{% extends 'base.html.twig' %}

{% block title %}Koszyk{% endblock %}

{% block body %}
<div class="page-header">
    <h1>Koszyk</h1>
    <div class="btn-group">
        <a href="{{ path('catalog_product_index') }}" class="btn btn-secondary">‚Üê Kontynuuj zakupy</a>
        {% if cart and cart.items|length > 0 %}
            <form action="{{ path('cart_clear') }}" method="post" data-turbo="false">
                <button type="submit" class="btn btn-warning" onclick="return confirm('Czy na pewno chcesz wyczy≈õciƒá koszyk?')">Wyczy≈õƒá koszyk</button>
            </form>
        {% endif %}
    </div>
</div>

{% for flash in app.flashes('success') %}
    <div class="alert alert-success">{{ flash }}</div>
{% endfor %}

{% if cart and cart.items|length > 0 %}
    <table class="table">
        <thead>
            <tr>
                <th>Produkt</th>
                <th>Cena jednostkowa</th>
                <th>Ilo≈õƒá</th>
                <th style="text-align: right;">Suma</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart.items %}
                <tr>
                    <td><strong>{{ productNames[item.productId] ?? 'Nieznany produkt' }}</strong></td>
                    <td>{{ item.priceAtAdd }} PLN</td>
                    <td>
                        <form action="{{ path('cart_update', {productId: item.productId}) }}" method="post" class="inline-form" data-turbo="false">
                            <input type="number" name="quantity" value="{{ item.quantity }}" min="0" style="width: 70px">
                            <button type="submit" class="btn btn-sm btn-secondary">Zmie≈Ñ</button>
                        </form>
                    </td>
                    <td style="text-align: right;"><strong>{{ (item.priceAtAdd * item.quantity)|number_format(2) }} PLN</strong></td>
                    <td>
                        <form action="{{ path('cart_remove', {productId: item.productId}) }}" method="post" class="inline-form" data-turbo="false">
                            <button type="submit" class="btn btn-danger btn-sm">Usu≈Ñ</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" style="text-align: right;">Razem do zap≈Çaty:</th>
                <th style="text-align: right; font-size: 1.3rem; color: #667eea;">{{ total }} PLN</th>
                <th></th>
            </tr>
        </tfoot>
    </table>
{% else %}
    <div class="empty-state">
        <p>üõí Tw√≥j koszyk jest pusty</p>
        <a href="{{ path('catalog_product_index') }}" class="btn btn-primary">Przejd≈∫ do sklepu</a>
    </div>
{% endif %}
{% endblock %}
