{% extends 'base.html.twig' %}

{% block title %}Porównanie: Port/Adapter vs Query Bus{% endblock %}

{% block body %}
<div class="page-header">
    <h1>Porównanie podejść</h1>
    <a href="{{ path('catalog_product_show', {id: product.id}) }}" class="btn btn-secondary">← Powrót do produktu</a>
</div>

<div class="product-info" style="margin-bottom: 2rem; padding: 1rem; background: #f5f5f5; border-radius: 4px;">
    <strong>Produkt:</strong> {{ product.name }} (ID: {{ product.id }})
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

    {# Port/Adapter #}
    <div class="approach-card" style="padding: 1.5rem; border: 2px solid #007bff; border-radius: 8px;">
        <h2 style="color: #007bff;">Port/Adapter</h2>

        <div class="results" style="margin: 1.5rem 0; padding: 1rem; background: #e7f3ff; border-radius: 4px;">
            <p><strong>Stan magazynowy:</strong> {{ portAdapter.stockQuantity }} szt.</p>
            <p><strong>W koszyku:</strong> {{ portAdapter.cartQuantity }} szt.</p>
        </div>

        <h3>Jak to działa:</h3>
        <pre style="background: #2d2d2d; color: #f8f8f2; padding: 1rem; border-radius: 4px; font-size: 12px; overflow-x: auto;">
// Wstrzykiwanie przez konstruktor
public function __construct(
    private StockInfoInterface $stockInfo,
    private CartQuantityInterface $cartQuantity,
) {}

// Użycie - type-safe
$stock = $this->stockInfo->getQuantity($id);
$cartQty = $this->cartQuantity->getQuantityInCart($cartId, $id);</pre>

        <h3>Struktura plików:</h3>
        <ul style="font-size: 14px;">
            <li><code>Catalog/Port/StockInfoInterface.php</code></li>
            <li><code>Inventory/Adapter/StockInfoAdapter.php</code></li>
            <li><code>services.yaml</code> - alias</li>
        </ul>

        <h3 style="color: green;">Zalety:</h3>
        <ul style="font-size: 14px;">
            <li>Type-safe (IDE podpowiada)</li>
            <li>Jasne zależności w konstruktorze</li>
            <li>Łatwe mockowanie w testach</li>
        </ul>

        <h3 style="color: red;">Wady:</h3>
        <ul style="font-size: 14px;">
            <li>3 pliki na operację (Port + Adapter + alias)</li>
            <li>Przy 50 operacjach = ~150 plików</li>
            <li>Rozproszenie kodu po modułach</li>
        </ul>
    </div>

    {# Query Bus #}
    <div class="approach-card" style="padding: 1.5rem; border: 2px solid #28a745; border-radius: 8px;">
        <h2 style="color: #28a745;">Query Bus</h2>

        <div class="results" style="margin: 1.5rem 0; padding: 1rem; background: #e7ffe7; border-radius: 4px;">
            <p><strong>Stan magazynowy:</strong> {{ queryBus.stockQuantity }} szt.</p>
            <p><strong>W koszyku:</strong> {{ queryBus.cartQuantity }} szt.</p>
        </div>

        <h3>Jak to działa:</h3>
        <pre style="background: #2d2d2d; color: #f8f8f2; padding: 1rem; border-radius: 4px; font-size: 12px; overflow-x: auto;">
// Jedna zależność dla wszystkich operacji
public function __construct(
    private QueryBusInterface $queryBus,
) {}

// Użycie - Query jako obiekt
$stock = $this->queryBus->query(
    new GetStockQuantityQuery(productId: $id)
);
$cartQty = $this->queryBus->query(
    new GetCartQuantityQuery(sessionId: $cartId, productId: $id)
);</pre>

        <h3>Struktura plików:</h3>
        <ul style="font-size: 14px;">
            <li><code>Shared/Query/Inventory/GetStockQuantityQuery.php</code></li>
            <li><code>Inventory/QueryHandler/GetStockQuantityHandler.php</code></li>
            <li>(bez aliasu w services.yaml)</li>
        </ul>

        <h3 style="color: green;">Zalety:</h3>
        <ul style="font-size: 14px;">
            <li>Jedna zależność (QueryBus) dla wszystkich</li>
            <li>2 pliki na operację (Query + Handler)</li>
            <li>Łatwe dodanie middleware (cache, log)</li>
            <li>Query w jednym miejscu (Shared)</li>
        </ul>

        <h3 style="color: red;">Wady:</h3>
        <ul style="font-size: 14px;">
            <li>Brak type-hints dla wyniku</li>
            <li>Dodatkowa warstwa abstrakcji</li>
            <li>Trudniejsze debugowanie</li>
        </ul>
    </div>

</div>

<div style="margin-top: 3rem; padding: 1.5rem; background: #fff3cd; border-radius: 8px;">
    <h2>Kiedy co wybrać?</h2>

    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
        <thead>
            <tr style="background: #ffc107;">
                <th style="padding: 0.75rem; text-align: left;">Sytuacja</th>
                <th style="padding: 0.75rem; text-align: center;">Port/Adapter</th>
                <th style="padding: 0.75rem; text-align: center;">Query Bus</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border-bottom: 1px solid #ddd;">Mały projekt (&lt;10 operacji)</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Tak</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Nie</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border-bottom: 1px solid #ddd;">Duży projekt (50+ operacji)</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Nie</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Tak</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border-bottom: 1px solid #ddd;">Potrzebujesz cache/logging middleware</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Trudne</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Tak</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border-bottom: 1px solid #ddd;">Wymagana pełna type-safety</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Tak</td>
                <td style="padding: 0.75rem; text-align: center; border-bottom: 1px solid #ddd;">Nie</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem;">Projekt ~150 tabel</td>
                <td style="padding: 0.75rem; text-align: center;">Hybrid</td>
                <td style="padding: 0.75rem; text-align: center;">Tak</td>
            </tr>
        </tbody>
    </table>
</div>

{% endblock %}
